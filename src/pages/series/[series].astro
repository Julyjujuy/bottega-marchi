---
import Base from "../../layouts/Base.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const ss = await getCollection("series");
  return ss.map(({ data }) => ({ params: { series: data.slug } }));
}

const { series } = Astro.params;
const entry = (await getCollection("series")).find(s => s.data.slug === series);
if (!entry) throw new Error("Series not found");

const s = entry.data;
const pieces = [...(s.pieces ?? [])].sort(
  (a, b) => (a.order ?? 999) - (b.order ?? 999) || (a.title || "").localeCompare(b.title || "")
);
---
<Base title={`${s.title} â€“ Bottega Marchi`}>
  <main class="page">
    <section class="max-w-[1200px] mx-auto px-6 sm:px-8 md:px-10 lg:px-12">
      {s.description && (
  <div class="quiet mb-8 max-w-prose whitespace-pre-line">
    {s.description}
  </div>
)}


      <ul class="grid gap-y-14 gap-x-8 sm:grid-cols-2 md:grid-cols-3 lg:gap-x-12">
        {pieces.map((p) => (
          <li class="group">
            <!-- shows ONLY the first photo (cover) -->
            <a href={`/series/${series}/${p.slug}`} class="block">
              <div class="overflow-hidden rounded-xl">
                <div class="w-full aspect-[4/5]">
                  <img
                    src={p.cover}
                    alt={p.title}
                    class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-[1.02]"
                    loading="lazy"
                  />
                </div>
              </div>
              <p class="mt-4 text-sm leading-tight px-1 sm:px-2">
                <span class="brand">{p.title}</span><br />
              {p.subtitle && <><br /><span class="opacity-80">{p.subtitle}</span></>}
              </p>
            </a>
          </li>
        ))}
      </ul>
    </section>
  </main>
</Base>
